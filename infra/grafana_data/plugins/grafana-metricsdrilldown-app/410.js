"use strict";(self.webpackChunkgrafana_metricsdrilldown_app=self.webpackChunkgrafana_metricsdrilldown_app||[]).push([[410],{62427(e,t,r){r.d(t,{BR:()=>s,Hi:()=>i,KF:()=>a});var n=r(85959);const a=(0,r(85187).ef)(),s=(0,n.createContext)({trail:a});function i(){return(0,n.useContext)(s)}},3388(e,t,r){r.d(t,{E:()=>m});var n=r(46089),a=r(89642),s=r(82007),i=r(85959),c=r.n(i),o=r(81159),l=r(30858),u=r(58544);function m({error:e}){const t=(0,s.useStyles2)(d),r=(0,o.useNavigate)(),{pathname:n,search:m}=(0,o.useLocation)(),p=(0,i.useCallback)(()=>{const e=new URLSearchParams(m),t=new URLSearchParams;["from","to","timezone"].filter(t=>e.has(t)).forEach(r=>t.set(r,e.get(r))),r({pathname:n,search:t.toString()}),window.location.reload()},[r,n,m]),[g,f]=(0,i.useState)(!1);return c().createElement("div",{className:t.container},c().createElement(l.C,null),c().createElement(u._,{severity:"error",title:(0,a.t)("error-view.title","Fatal error!"),error:e,errorContext:{handheldBy:"React error boundary"},message:c().createElement(c().Fragment,null,c().createElement("p",{className:t.message},c().createElement(a.x6,{i18nKey:"error-view.message"},"Please"," ",c().createElement(s.TextLink,{href:"#",onClick:p},"try reloading the page")," ","or, if the problem persists, contact your organization admin. Sorry for the inconvenience.")),c().createElement("p",null,c().createElement(s.Collapse,{className:t.callStack,label:(0,a.t)("error-view.stack-trace-label","View stack trace"),isOpen:g,onToggle:()=>f(!g)},c().createElement("pre",null,c().createElement("code",null,e.stack)))))}))}function d(e){return{container:(0,n.css)({position:"relative",margin:e.spacing(2)}),message:(0,n.css)({margin:e.spacing(2,0,1,0)}),callStack:(0,n.css)({backgroundColor:"transparent",border:"0 none","& button":(0,n.css)({paddingLeft:e.spacing(1.5)}),"& button:focus":(0,n.css)({outline:"none",boxShadow:"none"}),"& button > svg":(0,n.css)({marginLeft:e.spacing(-2),marginRight:e.spacing(.5)}),'& [class$="collapse__loader"]':(0,n.css)({display:"none"})})}}},30858(e,t,r){r.d(t,{C:()=>l});var n=r(46089),a=r(82007),s=r(85959),i=r.n(s),c=r(43939),o=r(66423);function l(){const e=(0,a.useStyles2)(u);return i().createElement("div",{className:e.container},i().createElement(a.Stack,{direction:"row",gap:1,alignItems:"center"},i().createElement(c.l,{className:e.feedbackStatic}),i().createElement(o.U,null)))}function u(e){return{container:(0,n.css)({position:"absolute",top:e.spacing(2),right:e.spacing(2),zIndex:e.zIndex.dropdown}),feedbackStatic:(0,n.css)({position:"static"})}}},99251(e,t,r){r.d(t,{S:()=>u,X:()=>o});var n=r(85959),a=r.n(n),s=r(81159),i=r(4405),c=r(62427);const o=(0,n.lazy)(()=>r.e(946).then(r.bind(r,91946))),l=()=>{const e=(0,s.useLocation)();return a().createElement(s.Navigate,{to:`${i.b.Drilldown}${e.search}`,replace:!0})},u=()=>{const{trail:e}=(0,c.Hi)();return a().createElement(s.Routes,null,a().createElement(s.Route,{path:i.b.Drilldown,element:a().createElement(o,{trail:e})}),a().createElement(s.Route,{path:i.b.Trail,element:a().createElement(l,null)}),a().createElement(s.Route,{path:"*",element:a().createElement(s.Navigate,{to:i.b.Drilldown,replace:!0})}))}},58410(e,t,r){r.r(t),r.d(t,{default:()=>x});var n=r(18531),a=r(85959),s=r.n(a),i=r(3388),c=r(99251),o=r(7291),l=r(45914),u=r(30384),m=r(16632),d=r(69642),p=r(85187),g=r(83921),f=r(67477),h=r(83444);class b extends f.SceneObjectBase{filterVariableOptions(e){const t=e.state.options;if(0===t.length)return;const r=t.filter(e=>!String(e.value).startsWith("asserts"));r.length!==t.length&&e.setState({options:r})}constructor(e){super({}),this.addActivationHandler(()=>{const t=this.getRoot().subscribeToEvent(h.Y,t=>{var r;(null===(r=e.metric)||void 0===r?void 0:r.startsWith("asserts"))||this.filterVariableOptions(t.payload)});return()=>t.unsubscribe()})}}var v=r(72475),E=r(45647),w=r(90518),S=r(35942);class _ extends f.SceneObjectBase{constructor(){var e,t,r;super({}),e=this,t="processedPanels",r=new WeakSet,t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,this.addActivationHandler(()=>{const e=this.getRoot(),t=()=>{const t=f.sceneGraph.findAllObjects(e,e=>e instanceof v.m);for(const e of t){var r;if(this.processedPanels.has(e))continue;const{metric:t,panelConfig:n}=e.state,a=(0,E.K)(t),s=null===(r=(S.x.getItem(w.V.METRIC_PREFS)||{})[t])||void 0===r?void 0:r.config;"classic-histogram"!==a&&"native-histogram"!==a||s||"heatmap"!==n.type||e.update({type:"percentiles"},{queries:[{fn:"histogram_quantile",params:{percentiles:[99,90,50]}}]}),this.processedPanels.add(e)}};t();const r=e.subscribeToState(t);return()=>r.unsubscribe()})}}var y=r(25576),k=r(82402);function R(e){const t=e.match(/^([a-zA-Z0-9]+)/);return t?t[1]:e}const x=e=>{const[t]=(0,o.n)(),r=(0,a.useRef)(!1);let f,h;(0,a.useEffect)(()=>{r.current||(r.current=!0,(0,d.z)("exposed_component_viewed",{component:"knowledge_graph_source_metrics"}))},[]);const{scenario:v,sourceMetrics:E,fallbackQuery:w}=function(e){if(e.sourceMetrics&&e.sourceMetrics.length>0)return{scenario:1===e.sourceMetrics.length?"single_source_metric":"multiple_source_metrics",sourceMetrics:e.sourceMetrics,fallbackQuery:void 0};let t;if(e.query)try{t=(0,y.$9)(e.query)}catch(t){m.v.error(new Error(`Failed to parse PromQL query: ${t}`),{query:e.query})}return t?{scenario:"recording_rule_fallback",sourceMetrics:void 0,fallbackQuery:t}:{scenario:"missing_metric_information",sourceMetrics:void 0,fallbackQuery:void 0}}(e);switch(v){case"single_source_metric":f=E[0].metricName,h=E[0].labels.map(e=>(0,g.Do)(e));break;case"multiple_source_metrics":h=E[0].labels.map(e=>(0,g.Do)(e));const t=["asserts","ALERTS"],r=function(e){const t=new Set(e.map(R));return Array.from(t)}(E.map(e=>e.metricName)).filter(e=>t.every(t=>!e.startsWith(t)));if(null==r?void 0:r.length){const e=`${p.mc}-${u.G.prefix}`;n.locationService.partial({[e]:r.join(",")},!0);const t=`${p.mc}-var-${l.NJ}`;n.locationService.partial({[t]:"alphabetical"},!0)}break;case"recording_rule_fallback":f=w.metric,h=w.labels.map(e=>(0,g.Do)(e));break;case"missing_metric_information":const a=new Error("Missing metric information for Knowledge Graph insight");return m.v.error(a,{query:e.query}),s().createElement(i.E,{error:a})}const S=(0,p.ef)({metric:f,initialDS:e.dataSource.uid,initialFilters:h,$timeRange:(0,k._)(e.initialStart,e.initialEnd),embedded:!0,$behaviors:[new b({metric:f}),new _]});return s().createElement("div",{"data-testid":"metrics-drilldown-embedded-label-breakdown"},t?s().createElement(i.E,{error:t}):s().createElement(c.X,{trail:S}))}},82402(e,t,r){r.d(t,{_:()=>i});var n=r(87781),a=r(67477);function s(e){return"string"==typeof e&&n.dateMath.isMathString(e)?e:n.dateMath.toDateTime(new Date(e),{roundUp:!1}).toISOString()}function i(e,t){return new a.SceneTimeRange({from:s(e),to:s(t)})}}}]);
//# sourceMappingURL=410.js.map?_cache=d81a4590c8fbe87ff2b7