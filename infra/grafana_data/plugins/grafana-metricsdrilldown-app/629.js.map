{"version":3,"file":"629.js?_cache=7596f196681baee41999","mappings":"mPAYO,SAASA,GAAU,MAAEC,IAC1B,MAAMC,GAASC,EAAAA,EAAAA,YAAWC,GAEpBC,GAAWC,EAAAA,EAAAA,gBACX,SAAEC,EAAQ,OAAEC,IAAWC,EAAAA,EAAAA,eAEvBC,GAAgBC,EAAAA,EAAAA,aAAY,KAChC,MAAMC,EAAe,IAAIC,gBAAgBL,GACnCM,EAAkB,IAAID,gBAG5B,CAAC,OAAQ,KAAM,YACZE,OAAQC,GAAQJ,EAAaK,IAAID,IACjCE,QAASF,GAAQF,EAAgBK,IAAIH,EAAKJ,EAAaQ,IAAIJ,KAE9DX,EAAS,CAAEE,WAAUC,OAAQM,EAAgBO,aAC7CC,OAAOC,SAASC,UACf,CAACnB,EAAUE,EAAUC,KAEjBiB,EAAgBC,IAAqBC,EAAAA,EAAAA,WAAS,GAErD,OACE,kBAACC,MAAAA,CAAIC,UAAW3B,EAAO4B,WACrB,kBAACC,EAAAA,EAAYA,MACb,kBAACC,EAAAA,EAAYA,CACXC,SAAS,QACTC,OAAOC,EAAAA,EAAAA,GAAE,mBAAoB,gBAC7BlC,MAAOA,EACPmC,aAAc,CAAEC,WAAY,wBAC5BC,QACE,oCACE,kBAACC,IAAAA,CAAEV,UAAW3B,EAAOoC,SACnB,kBAACE,EAAAA,GAAKA,CAACC,QAAQ,sBAAqB,SAC3B,IACP,kBAACC,EAAAA,SAAQA,CAACC,KAAK,IAAIC,QAASlC,GAAe,0BAE/B,IAAI,+FAIpB,kBAAC6B,IAAAA,KACC,kBAACM,EAAAA,SAAQA,CACPhB,UAAW3B,EAAO4C,UAClBC,OAAOZ,EAAAA,EAAAA,GAAE,+BAAgC,oBACzCa,OAAQvB,EACRwB,SAAU,IAAMvB,GAAmBD,IAEnC,kBAACyB,MAAAA,KACC,kBAACC,OAAAA,KAAMlD,EAAMmD,aAS/B,CAEA,SAAShD,EAAUiD,GACjB,MAAO,CACLvB,WAAWwB,EAAAA,EAAAA,KAAI,CACbC,SAAU,WACVC,OAAQH,EAAMI,QAAQ,KAExBnB,SAASgB,EAAAA,EAAAA,KAAI,CACXE,OAAQH,EAAMI,QAAQ,EAAG,EAAG,EAAG,KAEjCX,WAAWQ,EAAAA,EAAAA,KAAI,CACbI,gBAAiB,cACjBC,OAAQ,SAER,YAAYL,EAAAA,EAAAA,KAAI,CACdM,YAAaP,EAAMI,QAAQ,OAG7B,kBAAkBH,EAAAA,EAAAA,KAAI,CACpBO,QAAS,OACTC,UAAW,SAGb,kBAAkBR,EAAAA,EAAAA,KAAI,CACpBS,WAAYV,EAAMI,SAAS,GAC3BO,YAAaX,EAAMI,QAAQ,MAG7B,iCAAiCH,EAAAA,EAAAA,KAAI,CACnCW,QAAS,WAIjB,C,oGC/FO,SAASlC,IACd,MAAM7B,GAASC,EAAAA,EAAAA,YAAWC,GAE1B,OACE,kBAACwB,MAAAA,CAAIC,UAAW3B,EAAO4B,WACrB,kBAACoC,EAAAA,MAAKA,CAACC,UAAU,MAAMC,IAAK,EAAGC,WAAW,UACxC,kBAACC,EAAAA,EAAkBA,CAACzC,UAAW3B,EAAOqE,iBACtC,kBAACC,EAAAA,EAAUA,OAInB,CAEA,SAASpE,EAAUiD,GACjB,MAAO,CACLvB,WAAWwB,EAAAA,EAAAA,KAAI,CACbC,SAAU,WACVkB,IAAKpB,EAAMI,QAAQ,GACnBiB,MAAOrB,EAAMI,QAAQ,GACrBkB,OAAQtB,EAAMsB,OAAOC,WAEvBL,gBAAgBjB,EAAAA,EAAAA,KAAI,CAClBC,SAAU,WAGhB,C,+KCdA,MAAMsB,EAAgB,EAAGC,QAAOC,eAAcC,aAAYC,iBACxD,MAAOhF,IAASiF,EAAAA,EAAAA,KACVhF,GAASC,EAAAA,EAAAA,YAAWC,GACpB+E,GAAUC,EAAAA,EAAAA,SAAO,IAEvBC,EAAAA,EAAAA,WAAU,KACHF,EAAQG,UACXH,EAAQG,SAAU,GAClBC,EAAAA,EAAAA,GAAqB,2BAA4B,CAAEC,UAAW,qBAE/D,IAEH,MAAM,OAAEC,EAAM,OAAEC,IAAWC,EAAAA,EAAAA,IAAiBb,GAGtCc,GAAQC,EAAAA,EAAAA,SACZ,KACEC,EAAAA,EAAAA,IAAgB,CACdL,SACAM,UAAWd,EACXe,eAAgBN,EAAOO,IAAI,EAAGlD,QAAOmD,KAAIC,YAAa,CACpDnF,IAAK+B,EACLqD,SAAUF,EACVC,WAEFE,YAAYC,EAAAA,EAAAA,GAAiBvB,EAAcC,GAC3CuB,UAAU,EACVC,cAAc,IAElB,CAACf,EAAQR,EAAYS,EAAQX,EAAcC,IAG7C,OACE,kBAACpD,MAAAA,CAAI6E,cAAY,mCAAmC5E,UAAW3B,EAAO4B,WACnE7B,EAAQ,kBAACD,EAAAA,EAASA,CAACC,MAAOA,IAAY,kBAAC2F,EAAMc,UAAS,CAACC,MAAOf,MAKrE,SAASxF,IACP,MAAO,CACL0B,WAAWwB,EAAAA,EAAAA,KAAI,CACbsD,MAAO,UAGb,CAGA,S,0DC9CA,SAASC,EAAYC,GACnB,MAAoB,iBAATA,GAAqBC,EAAAA,SAASC,aAAaF,GAE7CA,EAGFC,EAAAA,SAASE,WAAW,IAAIC,KAAKJ,GAAO,CAAEK,SAAS,IAAUC,aAClE,CAwBO,SAASd,EAAiBe,EAAiCC,GAChE,OAAO,IAAIC,EAAAA,eAAe,CAAEF,KAAMR,EAAYQ,GAAOC,GAAIT,EAAYS,IACvE,C","sources":["webpack://grafana-metricsdrilldown-app/./App/ErrorView.tsx","webpack://grafana-metricsdrilldown-app/./App/HelpControls.tsx","webpack://grafana-metricsdrilldown-app/./exposedComponents/MiniBreakdown/MiniBreakdown.tsx","webpack://grafana-metricsdrilldown-app/./shared/utils/utils.timerange.ts"],"sourcesContent":["import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { t, Trans } from '@grafana/i18n';\nimport { Collapse, TextLink, useStyles2 } from '@grafana/ui';\nimport React, { useCallback, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\n\nimport { HelpControls } from './HelpControls';\nimport { InlineBanner } from './InlineBanner';\n\ntype ErrorViewProps = { error: Error };\n\nexport function ErrorView({ error }: Readonly<ErrorViewProps>) {\n  const styles = useStyles2(getStyles);\n\n  const navigate = useNavigate();\n  const { pathname, search } = useLocation();\n\n  const onClickReload = useCallback(() => {\n    const searchParams = new URLSearchParams(search);\n    const newSearchParams = new URLSearchParams();\n\n    // these are safe keys to keep\n    ['from', 'to', 'timezone']\n      .filter((key) => searchParams.has(key))\n      .forEach((key) => newSearchParams.set(key, searchParams.get(key)!));\n\n    navigate({ pathname, search: newSearchParams.toString() });\n    window.location.reload();\n  }, [navigate, pathname, search]);\n\n  const [isCollapseOpen, setIsCollapseOpen] = useState(false);\n\n  return (\n    <div className={styles.container}>\n      <HelpControls />\n      <InlineBanner\n        severity=\"error\"\n        title={t('error-view.title', 'Fatal error!')}\n        error={error}\n        errorContext={{ handheldBy: 'React error boundary' }}\n        message={\n          <>\n            <p className={styles.message}>\n              <Trans i18nKey=\"error-view.message\">\n                Please{' '}\n                <TextLink href=\"#\" onClick={onClickReload}>\n                  try reloading the page\n                </TextLink>{' '}\n                or, if the problem persists, contact your organization admin. Sorry for the inconvenience.\n              </Trans>\n            </p>\n            <p>\n              <Collapse\n                className={styles.callStack}\n                label={t('error-view.stack-trace-label', 'View stack trace')}\n                isOpen={isCollapseOpen}\n                onToggle={() => setIsCollapseOpen(!isCollapseOpen)}\n              >\n                <pre>\n                  <code>{error.stack}</code>\n                </pre>\n              </Collapse>\n            </p>\n          </>\n        }\n      />\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      position: 'relative',\n      margin: theme.spacing(2),\n    }),\n    message: css({\n      margin: theme.spacing(2, 0, 1, 0),\n    }),\n    callStack: css({\n      backgroundColor: 'transparent',\n      border: '0 none',\n\n      '& button': css({\n        paddingLeft: theme.spacing(1.5),\n      }),\n\n      '& button:focus': css({\n        outline: 'none',\n        boxShadow: 'none',\n      }),\n\n      '& button > svg': css({\n        marginLeft: theme.spacing(-2),\n        marginRight: theme.spacing(0.5),\n      }),\n\n      '& [class$=\"collapse__loader\"]': css({\n        display: 'none',\n      }),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Stack, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { GiveFeedbackButton } from 'AppDataTrail/header/GiveFeedbackButton';\nimport { PluginInfo } from 'AppDataTrail/header/PluginInfo/PluginInfo';\n\nexport function HelpControls() {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <Stack direction=\"row\" gap={1} alignItems=\"center\">\n        <GiveFeedbackButton className={styles.feedbackStatic} />\n        <PluginInfo />\n      </Stack>\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      position: 'absolute',\n      top: theme.spacing(2),\n      right: theme.spacing(2),\n      zIndex: theme.zIndex.dropdown,\n    }),\n    feedbackStatic: css({\n      position: 'static',\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { useEffect, useMemo, useRef } from 'react';\n\nimport { ErrorView } from 'App/ErrorView';\nimport { useCatchExceptions } from 'App/useCatchExceptions';\nimport { reportExploreMetrics } from 'shared/tracking/interactions';\nimport { newMetricsTrail } from 'shared/utils/utils';\n\nimport { parsePromQLQuery } from '../../extensions/links';\nimport { toSceneTimeRange } from '../../shared/utils/utils.timerange';\n\nexport interface MiniBreakdownProps {\n  query: string;\n  initialStart: string | number;\n  initialEnd: string | number;\n  dataSource: string; // The data source UID\n}\n\nconst MiniBreakdown = ({ query, initialStart, initialEnd, dataSource }: MiniBreakdownProps) => {\n  const [error] = useCatchExceptions();\n  const styles = useStyles2(getStyles);\n  const initRef = useRef(false);\n\n  useEffect(() => {\n    if (!initRef.current) {\n      initRef.current = true;\n      reportExploreMetrics('exposed_component_viewed', { component: 'mini_breakdown' });\n    }\n  }, []);\n\n  const { metric, labels } = parsePromQLQuery(query);\n\n  // useMemo to avoid recreating the trail on every render\n  const trail = useMemo(\n    () =>\n      newMetricsTrail({\n        metric,\n        initialDS: dataSource,\n        initialFilters: labels.map(({ label, op, value }) => ({\n          key: label,\n          operator: op,\n          value,\n        })),\n        $timeRange: toSceneTimeRange(initialStart, initialEnd),\n        embedded: true,\n        embeddedMini: true, // Enable mini mode for tooltip navigation preview\n      }),\n    [metric, dataSource, labels, initialStart, initialEnd]\n  );\n\n  return (\n    <div data-testid=\"metrics-drilldown-mini-breakdown\" className={styles.container}>\n      {error ? <ErrorView error={error} /> : <trail.Component model={trail} />}\n    </div>\n  );\n};\n\nfunction getStyles() {\n  return {\n    container: css({\n      width: '300px',\n    }),\n  };\n}\n\n// Default export required for React.lazy\nexport default MiniBreakdown;\n\n// Named export for component usage\nexport { MiniBreakdown };\n","import { dateMath } from '@grafana/data';\nimport { SceneTimeRange } from '@grafana/scenes';\n\ntype MathStringOrUnixTimestamp = string | number;\n\n/**\n * Convert a time string or unix timestamp to a SceneTimeRange.\n *\n * @param time - The time string or unix timestamp.\n * @returns The SceneTimeRange.\n *\n * @example\n * ```ts\n * toSceneTime('now-1h')\n * ```\n *\n * @example\n * ```ts\n * toSceneTime(1723756800000)\n * ```\n */\nfunction toSceneTime(time: MathStringOrUnixTimestamp): string {\n  if (typeof time === 'string' && dateMath.isMathString(time)) {\n    // 'now', 'now-1h', etc.\n    return time;\n  }\n\n  return dateMath.toDateTime(new Date(time), { roundUp: false })!.toISOString();\n}\n\n/**\n * Convert a time string or unix timestamp to a SceneTimeRange.\n *\n * @param from - The start time.\n * @param to - The end time.\n * @returns The SceneTimeRange.\n *\n * @example\n * ```ts\n * toSceneTimeRange('now-1h', 'now')\n * ```\n *\n * @example\n * ```ts\n * toSceneTimeRange(1723756800000, 1723756800000)\n * ```\n *\n * @example\n * ```ts\n * toSceneTimeRange('now-1h', 1723756800000)\n * ```\n */\nexport function toSceneTimeRange(from: MathStringOrUnixTimestamp, to: MathStringOrUnixTimestamp): SceneTimeRange {\n  return new SceneTimeRange({ from: toSceneTime(from), to: toSceneTime(to) });\n}\n"],"names":["ErrorView","error","styles","useStyles2","getStyles","navigate","useNavigate","pathname","search","useLocation","onClickReload","useCallback","searchParams","URLSearchParams","newSearchParams","filter","key","has","forEach","set","get","toString","window","location","reload","isCollapseOpen","setIsCollapseOpen","useState","div","className","container","HelpControls","InlineBanner","severity","title","t","errorContext","handheldBy","message","p","Trans","i18nKey","TextLink","href","onClick","Collapse","callStack","label","isOpen","onToggle","pre","code","stack","theme","css","position","margin","spacing","backgroundColor","border","paddingLeft","outline","boxShadow","marginLeft","marginRight","display","Stack","direction","gap","alignItems","GiveFeedbackButton","feedbackStatic","PluginInfo","top","right","zIndex","dropdown","MiniBreakdown","query","initialStart","initialEnd","dataSource","useCatchExceptions","initRef","useRef","useEffect","current","reportExploreMetrics","component","metric","labels","parsePromQLQuery","trail","useMemo","newMetricsTrail","initialDS","initialFilters","map","op","value","operator","$timeRange","toSceneTimeRange","embedded","embeddedMini","data-testid","Component","model","width","toSceneTime","time","dateMath","isMathString","toDateTime","Date","roundUp","toISOString","from","to","SceneTimeRange"],"sourceRoot":""}